<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>"ImportError: cannot import name indexes"</title>
        <link rel="stylesheet" href="http://dustinfarris.com/theme/css/main.css" />
        <link href="http://dustinfarris.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Dustin Farris Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://dustinfarris.com/">Dustin Farris </a></h1>
                <nav><ul>
                    <li class="active"><a href="http://dustinfarris.com/category/blog.html">blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://dustinfarris.com/2012/05/16/importerror-cannot-import-name-indexes.html" rel="bookmark"
           title="Permalink to "ImportError: cannot import name indexes"">"ImportError: cannot import name indexes"</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-05-16T00:00:00+02:00">
                Published: Wed 16 May 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://dustinfarris.com/author/dustin-farris.html">Dustin Farris</a>
        </address>
<p>In <a href="http://dustinfarris.com/category/blog.html">blog</a>. </p>
<p>tags: <a href="http://dustinfarris.com/tag/django.html">Django</a> </p>
</footer><!-- /.post-info -->      <p>I'm certainly not the first person to hit this caveat with django-haystack, as
this error has been reported for <a href="https://github.com/toastdriven/django-haystack/issues/315">over a year</a> now. However, I had trouble finding a concise
and reputable workaround. <a href="https://github.com/toastdriven">Daniel Lindsley</a>, the guy behind django-haystack, has alluded to a <a href="http://django-haystack.readthedocs.org/en/v1.2.7/debugging.html#import-errors-on-start-up-mentioning-handle-registrations">workaround</a> in the haystack docs, but only
affirms it as the "right" fix in a <a href="https://github.com/toastdriven/django-haystack/issues/84#issuecomment-663791">somewhat buried</a> GitHub issue comment. If you get
this error, it is because of the way django-haystack sets up its indexes at
the beginning of Django initialization. If there are any other applications
attempting to do something similar, it can cause conflicts and circular
imports, often leading to this error. First, instruct haystack not to load
itself on initialization: :</p>
<div class="highlight"><pre>    <span class="c"># settings.py ...</span>
    <span class="n">HAYSTACK_ENABLE_REGISTRATIONS</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>


<p>Haystack cannot function without these
registrations however, so you have to "jump-start" it later in the startup
process. I chose to use urls.py. Do this for every application utilizing
haystack:</p>
<div class="highlight"><pre>    <span class="c"># urls.py ...</span>
    <span class="kn">from</span> <span class="nn">appname</span> <span class="kn">import</span> <span class="n">search_indexes</span>
</pre></div>


<p>Finally,
you'll have to modify <code>manage.py</code> so that commands like <code>rebuild_index</code> will
continue to work:</p>
<div class="highlight"><pre>    <span class="c"># manage.py ...</span>
    <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>
    <span class="kn">from</span> <span class="nn">projectname</span> <span class="kn">import</span> <span class="n">search_sites</span>
</pre></div>


<p>This is really
the only way to keep django-haystack and other apps working in harmony until
Django enhances its startup flow.</p>
    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'dustinfarris';
        var disqus_identifier = '2012/05/16/importerror-cannot-import-name-indexes.html';
        var disqus_url = 'http://dustinfarris.com/2012/05/16/importerror-cannot-import-name-indexes.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//dustinfarris.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://dustinfarris.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-13275015-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'dustinfarris';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>